<!DOCTYPE HTML>

<html>
	<head>

		<title>Explain #Catalonia</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Explain #Catalonia 2017, an analysis from tweets" />
		<meta name="keywords" content="referendum Cataluña, Catalonia, twitter, analysis, sentiment, barcellona, barcelona" />
		<meta name="author" content="Mauro Pelucchi" />

		<meta property="og:title" content="Explain #Catalonia" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="http://www.mauropelucchi.com/labs/referendumcat/index.html" />
		<meta property="og:description" content="Explain #Catalonia 2017, an analysis from tweets" />

		<meta itemprop="name" content="Explain #Catalonia" />
		<meta itemprop="description" content="Explain #Catalonia 2017, an analysis from tweets" />


		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->


		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
		<!-- Apple Touch Icons -->
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
		<link rel="apple-touch-icon" sizes="57x57" href="images/apple-touch-icon-57x57.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="images/apple-touch-icon-144x144.png" />
		<link rel="apple-touch-icon" sizes="57x57" href="images/apple-touch-icon-60x60.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-120x120.png" />
		<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-76x76.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="images/apple-touch-icon-152x152.png" />
		<!-- Windows 8 Tile Icons -->
	    <meta name="msapplication-square70x70logo" content="images/smalltile.png" />
		<meta name="msapplication-square150x150logo" content="images/mediumtile.png" />
		<meta name="msapplication-wide310x150logo" content="images/widetile.png" />
		<meta name="msapplication-square310x310logo" content="images/largetile.png" />

		<style>

		.arc text {
		  font: 10px sans-serif;
		  text-anchor: middle;
		}

		.arc path {
		  stroke: #fff;
		}

		.bld {
        	font-weight: bold;
    	}

		</style>
	</head>
	<body>

		<!-- Header -->
			<header id="header">

				<!-- Logo -->
					<h1 id="logo">Explain #Catalonia 2017</h1>

				<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="#intro">Intro</a></li>
							<li><a href="#visualize">Let the pictures talk</a></li>
							<li><a href="#who">Who tweets...</a></li>
							<li><a href="#analysis">Big data analysis</a></li>
							<li><a href="#text">Text analysis</a></li>
							<li><a href="#contact">Contact</a></li>
						</ul>
					</nav>

			</header>

		<!-- Intro -->
			<section id="intro" class="main style1 dark fullscreen">
				<div class="content container 75%">
					<header>
						<h2>Explain #Catalonia 2017</h2>
					</header>
					<p>A Big Data analysis of <strong>Referemdum 2017</strong> of 1th October 2017</p>
					<p><strong>90,000</strong> people, <strong>420,000</strong> tweets from Spain</p>

					<footer>
						<a href="#visualize" class="button style2 down">More</a>
					</footer>
				</div>
			</section>

		<!-- image map -->
			<section id="visualize" class="main style3 primary">
				<div class="content container">
					<header>
						<h2>Let the pictures talk</h2>
						<h3>people's thoughts through pictures</h3>
					</header>

					<div id="body" preserveAspectRatio="xMidYMid meet">
    				</div>

    				<p>This <strong>Image Map</strong> show the thoughts of the people captured through their tweets. After have scraped 420,000 tweets (220,000 after record linkage), we have cleaned, tokenized and clustering the terms.</p>
    				<p>Click on the images to zoom and see the details.</p>



				</div>
				<a href="#who" class="button style2 down anchored">Next</a>
			</section>

		<!-- super mario -->
			<section id="who" class="main style3 secondary">
				<div class="content container">
					<header>
						<h2>Who tweets...</h2>
						
					</header>
					<p>WikiLeaks founder <strong>@JulianAssange</strong> has talked about a historic independence referendum for the region of Catalonia, using his Twitter account to pump out a pro-independence narrative and to celebrating Catalan nationalism.</p>
					<p>Leader of @Podemons, <strong>Pablo Iglesias</strong> aligns with the independentistas and denounces that "in Spain there are political prisoners".</p>
					<p>The journalist of La Sexta, <strong>Jordi Évole</strong>, has dismantled <strong>Puigdemont @KRLS</strong>: during the entire interview he seeked contradictions and cracks in the speech of the President.
					</p>
					
				</div>

				

				<div class="box container 80% gallery">
					<a href="images/graph.png" class="image fit from-left"><img src="images/graph.png" title="WikiLeaks founder <strong>@JulianAssange</strong> has talked about a historic independence referendum for the region of Catalonia, using his Twitter account to pump out a pro-independence narrative and to celebrating Catalan nationalism.<br/>
					Leader of @Podemons, <strong>Pablo Iglesias</strong> aligns with the independentistas and denounces that 'in Spain there are political prisoners'.The journalist of La Sexta, <strong>Jordi Évole</strong>, has dismantled <strong>Puigdemont @KRLS</strong>: during the entire interview he seeked contradictions and cracks in the speech of the President." /></a>
					
					
				</div>

				<a href="#analysis" class="button style2 down anchored">Next</a>
			</section>



		<!-- big data analysis -->
			<section id="analysis" class="main style3 primary">
				<div class="content container">
					<header>
						<h2>Big data analysis</h2>
						<p>A pie chart based on sentiments by <strong>90,000</strong> users from all the Spain</p>
						<p>The <strong>yellow slice</strong> shows the percentage of positive tweets in catalan, spain and english languages.
					</header>

					<div class="box container 80%" id="chart">
					</div>
					



					<a href="#text" class="button style2 down anchored">Next</a>
			</section>


<!-- sentimet -->
			<section id="text" class="main style3 secondary">
				<div class="content container">
					<header>
						<h2>Text Analysis by Word Cloud</h2>
						
					</header>
					<p>the first 100 terms by frequency during the referendum
					</p>
					
				</div>

				<div class="box container 80%" id="cloud">


	</div>
				<a href="#footer" class="button style2 down anchored">Contact</a>
			</section>



		<!-- Footer -->
			<footer id="footer">

				<!-- Icons -->
					<ul class="actions" id="contact">
						<li>&copy; Mauro Pelucchi</li>
						<li><a href="https://github.com/mauropelucchi/catalan-referendum">GitHub</a></li>
					</ul>

				<!-- Menu -->
					<ul class="menu">
						<li>mauro.pelucchi@gmail.com</li>
					</ul>

			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.poptrox.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script type="text/javascript" src="assets/js/d3.v3.min.js"></script>
    		<!-- <script type="text/javascript" src="assets/js/d3.layout.js"></script> -->
			<script type="text/javascript" src="assets/js/d3.layout.cloud.js"></script>





<script type="text/javascript">


/// pie chart
    var frequency_list = [{"text":"rajoy","size":100},
{"text":"cataluna","size":89},
{"text":"referendum","size":85},
{"text":"espana","size":27},
{"text":"hoy","size":18},
{"text":"puigdemont","size":13},
{"text":"votar","size":13},
{"text":"decir","size":11},
{"text":"represi","size":16},
{"text":"herir","size":10},
{"text":"gobernar","size":9},
{"text":"poder","size":20},
{"text":"perder","size":20},
{"text":"provocar","size":9},
{"text":"policial","size":22},
{"text":"violencia","size":7},
{"text":"cobarde","size":7},
{"text":"valer","size":18},
{"text":"pedro","size":6},
{"text":"inepto","size":6},
{"text":"amable","size":6},
{"text":"davidbroncano","size":6},
{"text":"mentiroso","size":6},
{"text":"brutal","size":6},
{"text":"chiste","size":6},
{"text":"desas","size":6},
{"text":"independencia","size":6},
{"text":"democracia","size":6},
{"text":"querer","size":6},
{"text":"donar","size":5},
{"text":"ilegal","size":5},
{"text":"verg","size":5},
{"text":"hablar","size":5},
{"text":"ver","size":5},
{"text":"presidente","size":5},
{"text":"pasar","size":4},
{"text":"deber","size":4},
{"text":"comenzar","size":4},
{"text":"aceptar","size":4},
{"text":"especial","size":4},
{"text":"civil","size":4},
{"text":"ciudadano","size":4},
{"text":"gente","size":4},
{"text":"mirar","size":4},
{"text":"europa","size":14},
{"text":"madurar","size":4},
{"text":"agarzon","size":4},
{"text":"guardia","size":3},
{"text":"prensar","size":3},
{"text":"poblar","size":3},
{"text":"recoger","size":3},
{"text":"tras","size":3},
{"text":"defender","size":3},
{"text":"solar","size":3},
{"text":"apoyar","size":3},
{"text":"internacional","size":3},
{"text":"preguntar","size":3},
{"text":"pensar","size":3},
{"text":"partir","size":3},
{"text":"salir","size":3},
{"text":"mismo","size":3},
{"text":"puerta","size":3},
{"text":"venezuela","size":3},
{"text":"madrid","size":3},
{"text":"dimisión","size":3}];

var w = 300;
var h = 300;
var r = h/2;
var aColor = [
    'rgb(255, 204, 0)',
    'rgb(90, 30, 210)'
]

var data = [
    {"label":"positive", "value":55}, 
    {"label": "negative", "value":45}
];



var vis = d3.select('#chart').append("svg:svg").data([data]).attr("width", w).attr("height", h).append("svg:g").attr("transform", "translate(" + r + "," + r + ")");

var pie = d3.layout.pie().value(function(d){return d.value;});

// Declare an arc generator function
var arc = d3.svg.arc().outerRadius(r);

// Select paths, use arc generator to draw
var arcs = vis.selectAll("g.slice").data(pie).enter().append("svg:g").attr("class", "slice");
arcs.append("svg:path")
    .attr("fill", function(d, i){return aColor[i];})
    .attr("d", function (d) {return arc(d);})
;

// Add the text
arcs.append("svg:text")
    .attr("transform", function(d){
        d.innerRadius = 100; /* Distance of label to the center*/
        d.outerRadius = r;
        return "translate(" + arc.centroid(d) + ")";}
    )
    .attr("text-anchor", "middle")
    .text( function(d, i) {return data[i].value + '%';})
;





////// word tag
 	var color = d3.scale.linear()
            .domain([0,1,2,3,4,5,6,10,15,20,100])
            .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);

    d3.layout.cloud().size([800, 300])
            .words(frequency_list)
            .rotate(0)
            .fontSize(function(d) { return ((d.size < 10) ? d.size*3: d.size); })
            .on("end", draw)
            .start();

    function draw(words) {
        d3.select("#cloud").append("svg")
                .attr("width", 850)
                .attr("height", 350)
                .attr("class", "wordcloud")
                .append("g")
                // without the transform, words words would get cutoff to the left and top, they would
                // appear outside of the SVG area
                .attr("transform", "translate(320,200)")
                .selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", function(d) { return d.size + "px"; })
                .style("fill", function(d, i) { return color(i); })
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .text(function(d) { return d.text; });
    }



    // tree map

var aspect = 1200 / 500,
    body = d3.select('#body');


var w = body.node().getBoundingClientRect().width,
    h = body.node().getBoundingClientRect().width / aspect,
    x = d3.scale.linear().range([0, w]),
    y = d3.scale.linear().range([0, h]),
    color = d3.scale.category20c(),
    root,
    node;

var treemap = d3.layout.treemap()
    .round(true)
    .size([w, h])
    .sticky(true)
    .sort(function(a,b) {
    	if (a.order) {
    		return -1* a.order;
    	}
    	return a.value - b.value;
	})
    .value(function(d) { return d.size; });

var svg = d3.select("#body").append("div")
    .attr("class", "chart")
    .style("width", w + "px")
    .style("height", h + "px")
  	.append("svg:svg")
    .attr("width", w)
    .attr("height", h)
  	.append("svg:g")
    .attr("transform", "translate(.5,.5)");

var z = false;

d3.json("dati.json", function(data) {
  node = root = data;


  var nodes = treemap.nodes(root)
      .filter(function(d) { 
      	return !d.children;
     });

  var cell = svg.selectAll("g")
      .data(nodes)
      .enter().append("svg:g")
      .attr("class", "cell")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .on("click", function(d) { return zoom(node == d.parent ? root : d.parent); });

  cell.append("svg:rect")
      .attr("width", function(d) { return d.dx - 1; })
      .attr("height", function(d) { return d.dy - 1; })
      .style("fill", "#fff")
      .style("object-fit", "contain")
      .style("object-fit", "contain")
      .style("fill", function(d) { return "url('" + "#" + d.name + "_" + "img')"; });
      //.style("fill", function(d) { return color(d.parent.name); });

   cell.append("svg:pattern")
       	.attr("id", 
			function(d) { 
				return d.name + "_" + "img"; } 

			)
    	.attr('patternUnits', 'userSpaceOnUse')
    	.attr("width", function(d) { return d.dx - 1; })
    	.attr("height", function(d) { return d.dy - 1; })
    	.append("svg:image")
    	.attr("preserveAspectRatio", "none slice")
    	.attr("xlink:href", function(d) { 
				return (d.link) ? d.link : ""; } 

			)
    	.attr("width", function(d) { return d.dx - 1; })
    	.attr("height",function(d) { return d.dy - 1; })
    	.attr("x", 0)
    	.attr("y", 0);



  cell.append("svg:text")
      .attr("x", function(d) { return d.dx / 2; })
      .attr("y", 10) //function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .text(function(d) { return (d.label) ? d.label : d.name; })
      //.style("opacity", 0);
      .style("opacity", function(d) { return z ? 1 : 0; });
      //.style("opacity", function(d) { d.w = this.getComputedTextLength(); return d.dx > d.w ? 1 : 0; });


   
  d3.select(window).on("click", function() { zoom(root); });

  /*d3.select("select").on("change", function() {
    treemap.value(this.value == "size" ? size : count).nodes(root);
    zoom(node);
  });*/
});

function size(d) {
  return d.size;
}

function count(d) {
  return 1;
}

function zoom(d) {
  var kx = w / d.dx, ky = h / d.dy;
  x.domain([d.x, d.x + d.dx]);
  y.domain([d.y, d.y + d.dy]);
  z = (kx <= 1) ? false : true;

  var t = svg.selectAll("g.cell").transition()
      .duration(d3.event.altKey ? 7500 : 750)
      .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });

  t.select("rect")
      .attr("width", function(d) { return kx * d.dx - 1; })
      .attr("height", function(d) { return ky * d.dy - 1; });


  t.select("text")
      .attr("x",  function(d) { return kx * d.dx / 2; })
      .attr("y", 10) // function(d) { return ky * d.dy / 2; })
      .style("opacity", function(d) { return z ? 1 : 0; });
     // .style("opacity", function(d) { return kx * d.dx > d.w ? 1 : 0; });


  t.select("pattern")
  	  .attr("width", function(d) { return kx * d.dx - 1; })
      .attr("height", function(d) { return ky * d.dy - 1; });

  t.select("image")
  	  .attr("width", function(d) { return kx * d.dx - 1; })
      .attr("height", function(d) { return ky * d.dy - 1; })
      .attr("x", 0)
      .attr("y", function(d) { return z ? 15 : 0; });

  node = d;
  d3.event.stopPropagation();
}


d3.select(window)
  	.on("resize", function() {
    	var targetWidth = body.node().getBoundingClientRect().width;
    	body.attr("width", targetWidth);
    	body.attr("height", targetWidth / aspect);

		/*w = targetWidth;
    	h = targetWidth / aspect;
    	x = d3.scale.linear().range([0, w]);
    	y = d3.scale.linear().range([0, h]);

    	treemap.value(size).nodes(root);*/
    	zoom(root);

  });

    </script>
	</body>
</html>